services:
  tailnet:
    image: ghcr.io/sudosu404/tailnet-cli:latest
    command: ["--provider", "docker", "--verbose"]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - tailnet-state:/var/lib/tailnet
    environment:
      # Replace with your actual OAuth credentials
      # You can get these from: https://login.tailscale.com/admin/settings/oauth
      - TS_OAUTH_CLIENT_ID=${TS_OAUTH_CLIENT_ID}
      - TS_OAUTH_CLIENT_SECRET=${TS_OAUTH_CLIENT_SECRET}
    labels:
      - "tailnet.tailscale.oauth_client_id_env=TS_OAUTH_CLIENT_ID"
      - "tailnet.tailscale.oauth_client_secret_env=TS_OAUTH_CLIENT_SECRET"
      - "tailnet.tailscale.state_dir=/var/lib/tailnet"
      - "tailnet.tailscale.default_tags=tag:server" # Must match or be owned by your OAuth client's tag
      - "tailnet.global.metrics_addr=:9090"
    ports:
      - "9090:9090" # Metrics port
    networks:
      - tailnet-network

volumes:
  tailnet-state:

networks:
  tailnet-network:
    # Network is created by this compose file and shared with other compose files
    name: tailnet-shared-network
